name: Structured Call Summary
description: Summarise a call transcript using a schema.
model: openai/gpt-4.1
messages:
  - role: system
    content: You are an expert at analysing customer call transcripts at {{organisation}}.
  - role: user
    content: |
      You will be provided a call transcript and you must identify Topic, Customer Situation, Desired Outcome, Actions Taken, Call Resolution.  
      Try to include key details that draws directly from the call transcript. Ensure that each of the points are clear and concise.
      If a driving licence number is provided then find the driving details and use it to output the driver object. 
      If a Vehicle Registration Number or registration document ID is provided then find the vehicle details and use it to output the vehicle object.

      # STRICT OUTPUT FORMAT
      - Return only the JSON value that conforms to the schema. Do not include any additional text, explanations, headings, or separators.
      - Do not wrap the JSON in Markdown or code fences (no ``` or ```json).
      - Do not prepend or append any text (e.g., do not write "Here is the JSON:").
      - The response must be a single top-level JSON value exactly as required by the schema (object/array/etc.), with no trailing commas or comments.

      The output should be formatted as a JSON instance that conforms to the JSON schema below.

      As an example, for the schema {"properties": {"foo": {"title": "Foo", "description": "a list of strings", "type": "array", "items": {"type": "string"}}}, "required": ["foo"]} the object {"foo": ["bar", "baz"]} is a well-formatted instance of the schema. The object {"properties": {"foo": ["bar", "baz"]}} is not well-formatted.

      Here is the output schema (shown in a code block for readability only â€” do not include any backticks or Markdown in your output):
      ```
      {"$defs": {"Category": {"description": "Represents call categories.", "enum": ["Vehicle", "Driver", "Other"], "title": "Category", "type": "string"}, "Driver": {"description": "Represents a driver.", "properties": {"drivingLicenceNumber": {"description": "A UK driving licence number", "maxLength": 16, "minLength": 5, "title": "Drivinglicencenumber", "type": "string"}, "title": {"anyOf": [{"type": "string"}, {"type": "null"}], "description": "Title in full mode of address, e.g. Mr, Miss, Lord.", "title": "Title"}, "firstNames": {"description": "One or more first names separated by a space character.", "maxLength": 38, "title": "Firstnames", "type": "string"}, "lastName": {"description": "A single last name.", "maxLength": 43, "title": "Lastname", "type": "string"}, "dateOfBirth": {"anyOf": [{"type": "string"}, {"type": "null"}], "description": "The date on which the driver was born. Does not include time. In the format YYYY-MM-DD.", "title": "Dateofbirth"}, "postcode": {"anyOf": [{"maxLength": 8, "minLength": 5, "type": "string"}, {"type": "null"}], "description": "A complete UK postcode of the driver's address.", "title": "Postcode"}}, "required": ["drivingLicenceNumber", "title", "firstNames", "lastName", "dateOfBirth", "postcode"], "title": "Driver", "type": "object"}, "Vehicle": {"description": "Represents a vehicle.", "properties": {"registrationNumber": {"description": "The unique UK Vehicle Registration Number for a vehicle", "title": "Registrationnumber", "type": "string"}, "make": {"anyOf": [{"type": "string"}, {"type": "null"}], "description": "vehicle make", "title": "Make"}, "model": {"anyOf": [{"type": "string"}, {"type": "null"}], "description": "vehicle model", "title": "Model"}, "colour": {"anyOf": [{"type": "string"}, {"type": "null"}], "description": "vehicle colour", "title": "Colour"}, "registrationDocumentId": {"anyOf": [{"maxLength": 16, "minLength": 11, "type": "string"}, {"type": "null"}], "description": "The registration document ID for the vehicle", "title": "Registrationdocumentid"}}, "required": ["registrationNumber", "make", "model", "colour", "registrationDocumentId"], "title": "Vehicle", "type": "object"}}, "description": "Represents a call transcript.", "properties": {"driver": {"anyOf": [{"$ref": "#/$defs/Driver"}, {"type": "null"}], "default": null}, "vehicle": {"anyOf": [{"$ref": "#/$defs/Vehicle"}, {"type": "null"}], "default": null}, "startTime": {"description": "The date and time the call started. In the format YYYY-MM-DDTHH:MM:SSZ.", "title": "Starttime", "type": "string"}, "endTime": {"description": "The date and time the call ended. In the format YYYY-MM-DDTHH:MM:SSZ.", "title": "Endtime", "type": "string"}, "participants": {"description": "The names of the participants in the call, separated by a comma. The call agent's name appears first, then the customer's name.", "title": "Participants", "type": "string"}, "customerSituation": {"description": "The customer's current situation, context and any specific circumstances relevant to their inquiry or issue.", "title": "Customersituation", "type": "string"}, "desiredOutcome": {"description": "Clearly identify the customer's desired outcome or resolution for the call.", "title": "Desiredoutcome", "type": "string"}, "topics": {"description": "The main reason for the call.", "title": "Topics", "type": "string"}, "steps": {"description": "Each key step taken: documenting the steps taken, from the point of view of the agent, to resolve the issue or address the customer's need.", "items": {"type": "string"}, "title": "Steps", "type": "array"}, "resolution": {"description": "Was the agent able to resolve the customer's issue or request effectively and in a way that meets the customer's desired outcome.", "title": "Resolution"}, "category": {"description": "Categorise the call in one or more of these ways.", "items": {"$ref": "#/$defs/Category"}, "title": "Category", "type": "array"}, "sentiment": {"description": "The sentiment of the call, e.g. positive, negative, neutral.", "title": "Sentiment", "type": "string"}, "fcr": {"anyOf": [{"type": "boolean"}, {"type": "null"}], "description": "First Call Resolution (FCR): Whether the customer's issue was resolved in that single interaction without the need for any follow-up", "title": "Fcr"}}, "required": ["startTime", "endTime", "participants", "customerSituation", "desiredOutcome", "topics", "steps", "resolution", "category", "sentiment", "fcr"]}
      ```

      # IMPORTANT INSTRUCTIONS
      - You should output ONLY json that conforms to the schema with no preceding comments.  
      - If no Driving Licence number is specified don't output driver object. 
      - If no Vehicle Registration Number is specified don't output vehicle object. 
      - Do not include miliseconds in time values.
      - It is imperative you stick only to the information that is provided in the transcript. If any of the fields are not provided in the transcript don't set a value.

      Here is the transcript:
        <transcript>
        {{input}}
        </transcript>
testData:
  - input: |
      Put transcript here
  - organisation: |
      Driver and Vehicle Licensing Agency (DVLA)
